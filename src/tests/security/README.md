# 安全漏洞修復測試套件

本目錄包含針對已修復安全漏洞的自動化測試案例。

## 測試檔案

### 認證系統
- **auth.test.ts**: 測試權限檢查邏輯和密碼驗證機制
  - CRITICAL-01: 權限檢查使用 `every()` 而非 `some()`
  - CRITICAL-02: 密碼驗證機制

### 停車管理
- **parking.test.ts**: 測試車位分配的競爭條件
  - CRITICAL-05: 車位狀態檢查,防止覆蓋已佔用車位

### 押金管理
- **deposit.test.ts**: 測試餘額檢查機制
  - CRITICAL-11: 移除 `skipCheck` 參數,強制餘額驗證

### 設施預約
- **facility.test.ts**: 測試預約時間衝突和付款狀態驗證
  - HIGH-08: 預約時間衝突檢測
  - HIGH-09: 付款狀態更新驗證

### 資料驗證
- **validation.test.ts**: 測試通用資料驗證函式
  - HIGH-16: CSV 資料驗證
  - HIGH-17: State 路徑安全檢查

### IoT 系統
- **iot.test.ts**: 測試 IoT 裝置資料驗證
  - HIGH-20: 感測器數值範圍驗證

### 管理費計算
- **fee.test.ts**: 測試金額計算精度
  - HIGH-22: 使用 Decimal.js 避免浮點數精度問題

## 執行測試

```bash
# 執行所有安全測試
npm test src/tests/security

# 執行特定測試檔案
npm test src/tests/security/auth.test.ts

# 執行測試並顯示覆蓋率
npm test -- --coverage
```

## 測試覆蓋範圍

- ✅ 認證系統: 9 個測試案例
- ✅ 停車管理: 5 個測試案例
- ✅ 押金管理: 7 個測試案例
- ✅ 設施預約: 12 個測試案例
- ✅ 資料驗證: 10 個測試案例
- ✅ IoT 系統: 13 個測試案例
- ✅ 管理費計算: 10 個測試案例

**總計**: 66 個自動化測試案例

## 測試策略

### 正面測試
- 驗證修復後的正確行為
- 確保合法操作能夠成功

### 負面測試
- 驗證非法操作被正確拒絕
- 確保錯誤訊息清晰且有幫助

### 邊界測試
- 測試臨界值(如餘額剛好、時間邊界)
- 驗證極端情況的處理

### 回歸測試
- 確保修復不影響現有功能
- 驗證錯誤狀態能正確清除

## 持續整合

建議在 CI/CD 流程中:
1. 每次提交前執行所有測試
2. Pull Request 必須通過所有測試
3. 定期檢查測試覆蓋率
4. 新增功能時同步新增測試
