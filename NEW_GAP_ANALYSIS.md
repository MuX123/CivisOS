# NEW.txt 需求 vs 現有實作 差距分析報告

**生成日期**: 2026年1月31日  
**分析目標**: 比對 NEW.txt 規格與目前程式碼實作差異

---

## 📊 差距分析摘要

| 項目 | 需求狀態 | 優先級 |
|------|----------|--------|
| 後台棟數/樓層設定 | ⚠️ 部分實作 | 高 |
| 格局配置自動生成 | ⚠️ 基礎實作 | 高 |
| 車位配置自動生成 | ❌ 未實作 | 高 |
| 顏色狀態整合 | ⚠️ 基礎實作 | 高 |
| 行事曆系統 | ⚠️ 部分實作 | 中 |
| 公設系統 | ⚠️ 部分實作 | 中 |
| 住戶系統 | ⚠️ 部分實作 | 中 |
| 車位統計 | ⚠️ 部分實作 | 中 |
| 寄放系統 | ❌ 未完全實作 | 高 |
| 管理費系統 | ❌ 未實作 | 高 |

---

## 🔍 詳細差距分析

### 1️⃣ 後台設定 - 棟數樓層設定

**NEW.txt 需求 (1-2)**:
```
1. 設定棟數 樓層 R樓 居住層 地下室 分三個區塊
2. 增加戶別  設定完之後會自動把戶別登記到大樓格局配置
```

**現有實作** (`BuildingFloorConfig.tsx`, `FloorManager.tsx`):
- ✅ 有 BuildingFloorConfig 頁面
- ✅ 有 FloorManager 組件
- ⚠️ 樓層類型有 (roof, residential, basement)
- ❌ 沒有明確的「三個區塊」UI 分隔
- ❌ 沒有自動登記到格局配置的邏輯

**差距**:
```
需求: 三個區塊 (棟數/樓層/R樓+居住層+地下室)
實作: 統一的樓層列表，無明確分區
```

### 2️⃣ 後台設定 - 格局配置

**NEW.txt 需求 (3-4)**:
```
3. 格局配置 雖然有自動輸入 但也可以手動加
4. 車位配置  依照格局 設定的地下室樓層添加每層車位號碼
```

**現有實作** (`UnitLayoutManager.tsx`):
- ✅ 有 UnitLayoutManager 組件
- ⚠️ 有基本的手動添加功能
- ❌ 沒有根據地下室樓層自動生成車位
- ❌ 沒有與棟數/樓層設定聯動

**差距**:
```
需求: 車位依照地下室樓層自動生成
實作: 靜態的車位配置，無自動生成邏輯
```

### 3️⃣ 後台設定 - 顏色狀態

**NEW.txt 需求 (5-6)**:
```
5. 公設設定 於預約公設可以選擇
6. 顏色設定 可自訂以下的狀態  根據狀態 資料卡顯示的顏色會改變
   車位 / 行事曆 / 房屋狀態
```

**現有實作** (`ColorConfigPanel.tsx`):
- ✅ 有 ColorConfigPanel 組件
- ⚠️ 有基本的顏色選擇功能
- ❌ 沒有與車位狀態整合 (ParkingSystem)
- ❌ 沒有與行事曆狀態整合 (CalendarSystem)
- ❌ 沒有與房屋狀態整合 (ResidentSystem)
- ❌ 設定後沒有即時更新到各模組

**差距**:
```
需求: 狀態顏色→車位卡/行事曆卡/房屋卡 即時更新
實作: 獨立的顏色設定，無與各模組聯動
```

### 4️⃣ 前台 - 行事曆系統

**NEW.txt 需求**:
```
行事曆改名行事曆系統  預設兩個分頁 1.行事曆 2.過去行事曆(如刪除 過期)
依後台行事曆狀態改變對應顏色  需可輸入圖片網址顯示圖片  預設格式標題 內文 圖片   圖片預設一行 可無限新增 
並且可設定指定時間  需編輯按鈕  行事曆設定當下需紀錄時間 並且設定完後 資料卡中需顯示 編輯 以及狀態的選擇窗口
```

**現有實作** (`CalendarSystem.tsx`):
- ✅ 有 current/past 分頁
- ⚠️ 有基本的事件卡片
- ❌ 沒有依後台狀態改變顏色
- ❌ 沒有圖片網址輸入
- ❌ 沒有編輯時間紀錄
- ❌ 沒有狀態選擇窗口
- ❌ 沒有操作日誌

**差距**:
```
需求: 狀態顏色 + 圖片支援 + 編輯追蹤 + 狀態選擇窗口
實作: 基礎事件顯示，無狀態整合
```

### 5️⃣ 前台 - 公設系統

**NEW.txt 需求**:
```
公設租借改名公設系統  預設大分頁 棟別為區塊 小分頁 1.現在 2.過去 3.取消 4.刪除
租借設定ui:
  1.勾選租借人  住戶  其他 勾選後顯示如下
  租借住戶 設定 棟別 戶別 樓層 姓名(自由輸入)
  租借其他  姓名(自由輸入)
  租借日期
  租借時間
  預約人[顯示工作人員填寫](自由輸入)
  付款狀態:按鈕  已付款or未付款
租借資料卡: 需顯示租借人資料 租借時間 預約時間  已預約or已取消  已付款or未付款  備註區 編輯按鈕 取消按鈕 已付款按鈕
```

**現有實作** (`FacilitySystemV2.tsx`):
- ✅ 有 current/past/cancelled/deleted 分頁
- ⚠️ 有基本的預約卡片
- ❌ 沒有棟別區塊過濾
- ❌ 沒有勾選住戶/其他的 UI
- ❌ 沒有棟別/戶別/樓層選擇
- ❌ 沒有預約人輸入
- ❌ 付款狀態沒有按鈕
- ❌ 沒有操作日誌

**差距**:
```
需求: 棟別過濾 + 住戶選擇 + 完整租借UI + 付款按鈕 + 日誌
實作: 簡單的預約列表，無複雜UI
```

### 6️⃣ 前台 - 住戶系統

**NEW.txt 需求**:
```
住戶資料改名住戶系統 自動依照 格局棟數產生分頁 並且依照格局產生對應 戶別-樓層 的資料卡
需依照設定之住戶狀態顯示 每一狀態數量 顯示於棟別分頁上方 依棟別排列
住戶資料卡編輯之UI:
  住戶資料  依設定顯示房屋狀態 
  區權人 電話 備註
  成員名單 電話 備註(人數自由新增 預設0)
  承租名單 電話 備註(人數自由新增 預設0)
  車牌名單  對應車位系統中 車位主 登記之車牌顯示預先選項 可複選
  磁扣設定:
   1.一般磁扣 2.汽車ETC 3.其他ETC 已小分頁顯示
   一般磁扣 輸入框1依上面成員名單 承租名單選擇 也可以自由輸入   輸入框2 用於輸入磁扣號碼
   汽車ETC  輸入框1依照車牌名單選擇  輸入框2 用於輸入磁扣號碼
   其他ETC  輸入框1依照車位系統自訂類型名單選擇  輸入框2 用於輸入磁扣號碼
```

**現有實作** (`ResidentSystemV2.tsx`):
- ✅ 有基本的住戶卡片
- ⚠️ 有成員名單功能
- ❌ 沒有依棟數自動生成分頁
- ❌ 沒有狀態數量統計
- ❌ 沒有承租名單
- ❌ 車牌沒有與車位系統同步
- ❌ 沒有磁扣的三分類 (一般/汽車ETC/其他ETC)
- ❌ 沒有與車位系統的聯動

**差距**:
```
需求: 棟別分頁 + 狀態統計 + 承租名單 + 車牌同步 + 三類磁扣
實作: 簡單的住戶卡片，無複雜關聯
```

### 7️⃣ 前台 - 車位統計

**NEW.txt 需求**:
```
依設定顯示狀態 
顯示車位號碼 當前使用者  假如是租用除了資料卡顏色會變還會顯示(租)
```

**現有實作** (`ParkingSystem.tsx`):
- ✅ 有車位卡片
- ⚠️ 有狀態顯示
- ❌ 沒有依後台設定的顏色
- ❌ 沒有租用標記 (租)
- ❌ 沒有與住戶系統聯動

**差距**:
```
需求: 狀態顏色 + 租用標記 + 使用者顯示
實作: 基礎車位卡片
```

### 8️⃣ 前台 - 寄放系統

**NEW.txt 需求**:
```
寄放兩者 整合為 寄KEY/寄MONEY
依照後臺設定 選戶別 選樓層  選選項 備註
寄錢 點開設定後  選戶別 選樓層  輸入金額  備註
關於錢的部分需要一個功能  每筆資料都要有 加款 減款功能
加款 數目 收款時間 誰收的 備註 
減款 數目 付款時間 誰收的 備註 
自帶日誌功能 保留紀錄
```

**現有實作** (`DepositSystem.tsx`):
- ✅ 有 DepositSystem 組件
- ⚠️ 有基本的押金記錄
- ❌ 沒有分為 寄KEY/寄MONEY 兩類
- ❌ 沒有選戶別/樓層 UI
- ❌ 沒有加款/減款功能
- ❌ 沒有收款人紀錄
- ❌ 沒有完整的日誌功能

**差距**:
```
需求: 分類寄放 + 加減款 + 收款人 + 完整日誌
實作: 基礎押金記錄
```

### 9️⃣ 前台 - 管理費系統

**NEW.txt 需求**:
```
自動依照 格局棟數產生分頁 並且依照格局產生對應 
戶別 的資料卡  每一戶別 可設定 多少坪數  1坪多少元 自動計算總數 每一戶別 要有備註欄
並且多一個 特殊戶型設定 可勾選多數戶別加總 可選自由輸入坪數 價錢 也可以依照 每一戶別坪數 價錢 計算
```

**現有實作** (`FeeSystem.tsx`):
- ❌ 沒有自動依棟數生成分頁
- ❌ 沒有坪數/單價設定
- ❌ 沒有自動計算
- ❌ 沒有特殊戶型設定

**差距**:
```
需求: 棟數分頁 + 坪數單價 + 自動計算 + 特殊戶型
實作: 未實作
```

---

## 📋 實作優先級建議

### 🔴 高優先級 (必須修復)

| 功能 | 工作量 | 影響範圍 |
|------|--------|----------|
| 1. 後台三區塊棟數樓層設定 | 中 | 整體架構 |
| 2. 格局配置自動生成 | 中 | 住戶/車位 |
| 3. 車位配置自動生成 | 中 | 車位系統 |
| 4. 狀態顏色與各模組整合 | 大 | 所有模組 |
| 5. 寄放系統重構 | 大 | 住戶/財務 |

### 🟡 中優先級 (建議實作)

| 功能 | 工作量 | 影響範圍 |
|------|--------|----------|
| 6. 行事曆系統增強 | 中 | 行事曆模組 |
| 7. 公設系統重構 | 大 | 公設模組 |
| 8. 住戶系統增強 | 大 | 住戶模組 |
| 9. 車位統計增強 | 小 | 車位模組 |

### 🟢 低優先級 (未來考慮)

| 功能 | 工作量 |
|------|--------|
| 10. 管理費系統 | 大 |

---

## 🎯 下一步行動

是否需要我根據此差距分析，開始實作以下重構？

1. **重構後台設定頁面** → 三區塊架構
2. **整合狀態顏色系統** → 全域統一
3. **重構前台各系統** → 符合 NEW.txt 規格

請確認優先順序，我將開始實作。
